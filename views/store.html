<!-- Title -->
{{ define "title" }}
<title>Wine Database|Store</title>
{{ end }}
<!-- Description -->
{{ define "description" }}
    <meta name="description" content="This is the wine app store page">
{{ end }}
<!-- Body -->
{{ define "body" }}
    <style>
    	#map { height: 300px }
    </style>
    <h1 class="col-sm-12 row"><a href="//{{.Store.Website}}">{{.Store.Name}}</a></h1>
    <div class="row">
        <div class="col-sm-6">
            <strong>Address:</strong><br />
            {{.Store.Address}}<br />
            {{.Store.City}}, {{.Store.State}} {{.Store.Zip}}<br /><br />
            <a href="//{{.Store.Website}}">Website</a>
            <!-- Wines grouped by variety with avg price. -->
        </div>
        {{if ne .Store.Lattitude 0.0}}
            <div class="col-sm-6">
                <div id="map" class="visible-md-block visible-lg-block"></div>
            </div>
            <!-- Google Maps Script -->
            <script src="//maps.googleapis.com/maps/api/js?v=3.exp"></script>
            <script>
            		var storeLocation = new google.maps.LatLng({{.Store.Lattitude}}, {{.Store.Longitutde}}),
            		    map;

            	google.maps.event.addDomListener(window, "load", initialize);
            	function initialize() {
                        //setup google functions
                        var mapOptions = {
                            zoom: 12,
                            //coordinates of center
                            center: storeLocation
                        };
                    map = new google.maps.Map(document.getElementById('map'), mapOptions);

                    var marker = new google.maps.Marker({
                        position: storeLocation,
                        title: "{{.Store.Name}}",
                        map: map
                    });

            }
            </script>
        {{end}}
    </div>
    <h2 class="col-sm-12 row">Purchases by Wine</h2>
    {{range $wine := .Wines }}
        <div class="col-sm-12 row">
            <div class="panel panel-default">
                <div class="panel-heading"><strong style="font-size:1.6rem;"><a href="/wine/{{ $wine.Wine.Id.Hex }}">{{ $wine.Wine.Name }}</a></strong></div>
                <div class="panel-body">
                    {{range $index, $purchase := $wine.Purchases}}
                        <div class="purchase col-sm-4">
                        {{if ne $index 0}}<hr class="hidden-sm hidden-md hidden-lg">{{end}}
                            <div>
                                <strong><a href="/purchase/{{$purchase.Id.Hex}}">{{ $purchase.DatePurchased.Format "January 2, 2006" }}</a></strong>
                            </div>
                            <em>{{ $purchase.Year }} Vintage</em><br>
                            <span class="rating" rating="{{ $purchase.Rating }}"></span>{{with $purchase.BuyAgain }}<strong>&nbsp;&nbsp;&nbsp;Buy again!</strong>{{end}}<br>
                            <div class="row">
                                <div class="col-sm-5">
                                    <strong>Price</strong>
                                </div>
                                <div class="col-sm-7">
                                    ${{printf "%.2f" $purchase.Price}}{{with $purchase.OnSale }} (On sale){{end}}
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-5">
                                    <strong>Date Drank</strong>
                                </div>
                                <div class="col-sm-7">
                                    {{if not $purchase.DateDrank.IsZero }}{{ $purchase.DateDrank.Format "Jan 2, 2006"}}{{else}}Not Entered{{end}}
                                </div>
                            </div>
                        </div>
                    {{end }}
                </div>
            </div>
        </div>
    {{ end }}
    <script src="/js/jquery.raty.js"></script>
    <script>
    $(".rating").raty({
        path: "/img/",
        hints: ["Bad", "Poor", "Regular", "Good", "Great"],
        readOnly: true,
        score: function() {
            return $(this).attr("rating");
          },
    });
    </script>
{{ end }}
